<?xml version="1.0"?>
<tryton>
    <data>


<!-- Add other relevant icons -->
        
		<record model="ir.ui.icon" id="gnuhealth_invoice_icon">
			<field name="name">gnuhealth-invoice</field>
			<field name="path">icons/invoice.svg</field>
		</record>


    <!-- Appointment details -->

        <record model="ir.ui.view" id="gnuhealth_invoice_appointment_view">
            <field name="model">gnuhealth.appointment</field>
            <field name="type">form</field>
            <field name="inherit" ref="health.gnuhealth_appointment_form"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/form/group[@id=&quot;appointment_header&quot;]/field[@name=&quot;consultations&quot;]"
                        position="after">

                        <newline/>
                        <group colspan="4" id="group_appoinment">
                            <label name="no_invoice"/>
                            <field name="no_invoice"/>
                            <label name="validity_status"/>
                            <field name="validity_status" readonly="1"/>
                            <label name="appointment_validity_date"/>
                            <field name="appointment_validity_date"/>
                        </group>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="gnuhealth_invoice_appointment_tree">
            <field name="model">gnuhealth.appointment</field>
            <field name="type">tree</field>
            <field name="inherit" ref="health.gnuhealth_appointment_tree"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/tree/field[@name=&quot;speciality&quot;]"
                        position="before">

                        <field name="validity_status"/>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>


    <!-- Lab Test Requests details -->

        <record model="ir.ui.view" id="gnuhealth_invoice_labtest_request_form">
            <field name="model">gnuhealth.patient.lab.test</field>
            <field name="type">form</field>
            <field name="inherit" ref="health_lab.gnuhealth_lab_test_request_form"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/form/field[@name=&quot;state&quot;]"
                        position="after">

                        <newline/>
                        <group colspan="4" id="lab_invoice_status">
                            <label name="no_invoice"/>
                            <field name="no_invoice"/>
                            <label name="invoice_status"/>
                            <field name="invoice_status" readonly="1"/>
                        </group>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="gnuhealth_invoice_lab_test_request_tree">
            <field name="model">gnuhealth.patient.lab.test</field>
            <field name="type">tree</field>
            <field name="inherit" ref="health_lab.gnuhealth_lab_test_request_tree"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/tree/field[@name=&quot;state&quot;]"
                        position="after">

                        <field name="invoice_status"/>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>

        <menuitem name="Invoices" parent="health.gnuhealth_menu"
            id="gnuhealth_invoice_menu" sequence="990" icon="gnuhealth-invoice"/>

        <record model="ir.action.act_window" id="gnuhealth_action_invoiced_labtest_request">
            <field name="name">Invoiced Lab Test Requests</field>
            <field name="res_model">gnuhealth.patient.lab.test</field>
            <field name="domain">[('invoice_status','=','invoiced')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_labtest_request_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_tree"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_labtest_request"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_labtest_request_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_form"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_labtest_request"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_invoiced_labtest_request"
            id="gnuhealth_invoiced_labtest_request"/>

        <record model="ir.action.act_window" id="gnuhealth_action_tobeinvoiced_labtest_request">
            <field name="name">Lab Requests to be invoiced</field>
            <field name="res_model">gnuhealth.patient.lab.test</field>
            <field name="domain">[('invoice_status','=','tobe')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_labtest_request_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_tree"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_labtest_request"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_labtest_request_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_form"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_labtest_request"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_tobeinvoiced_labtest_request"
            id="gnuhealth_tobeinvoiced_labtest_request"/>


        <record model="ir.action.act_window" id="gnuhealth_action_today_tobeinvoiced_labtest_request">
            <field name="name">Today's Lab Requests to be invoiced</field>
            <field name="res_model">gnuhealth.patient.lab.test</field>
<!-- TODO:  <field name="domain">[('invoice_status','=','tobe'),('date','&gt;=',time.strftime('%Y-%m-%d 00:00:01')),('date','&lt;=',time.strftime('%Y-%m-%d 23:59:59'))]</field> -->
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_today_tobeinvoiced_labtest_request_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_tree"/>
            <field name="act_window" ref="gnuhealth_action_today_tobeinvoiced_labtest_request"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_today_tobeinvoiced_labtest_request_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health_lab.gnuhealth_lab_test_request_form"/>
            <field name="act_window" ref="gnuhealth_action_today_tobeinvoiced_labtest_request"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_today_tobeinvoiced_labtest_request"
            id="gnuhealth_today_tobeinvoiced_labtest_request"/>

        <record model="ir.action.act_window" id="gnuhealth_action_invoiced_appointment">
            <field name="name">Invoiced Appointments</field>
            <field name="res_model">gnuhealth.appointment</field>
            <field name="domain">[('validity_status','!=','tobe')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_appointment_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health.gnuhealth_appointment_tree"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_appointment"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_appointment_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health.gnuhealth_appointment_form"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_appointment"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_invoiced_appointment"
            id="gnuhealth_invoiced_appointment"/>

        <record model="ir.action.act_window" id="gnuhealth_action_tobeinvoiced_appointment">
            <field name="name">Appointments to be invoiced</field>
            <field name="res_model">gnuhealth.appointment</field>
            <field name="domain">[('validity_status','=','tobe')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_appointment_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health.gnuhealth_appointment_tree"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_appointment"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_appointment_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health.gnuhealth_appointment_form"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_appointment"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_tobeinvoiced_appointment"
            id="gnuhealth_tobeinvoiced_appointment"/>

        <record model="ir.action.act_window" id="gnuhealth_action_today_tobeinvoiced_appointment">
            <field name="name">Today's Appointments to be Invocied</field>
            <field name="res_model">gnuhealth.appointment</field>
<!-- TODO:  <field name="domain">[('validity_status','=','tobe'),('date','&gt;=',time.strftime('%Y-%m-%d 00:00:01')),('date','&lt;=',time.strftime('%Y-%m-%d 23:59:59'))]</field> -->
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_today_tobeinvoiced_appointment_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health.gnuhealth_appointment_tree"/>
            <field name="act_window" ref="gnuhealth_action_today_tobeinvoiced_appointment"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_today_tobeinvoiced_appointment_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health.gnuhealth_appointment_form"/>
            <field name="act_window" ref="gnuhealth_action_today_tobeinvoiced_appointment"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_today_tobeinvoiced_appointment"
            id="gnuhealth_today_tobeinvoiced_appointment"/>

        <record model="ir.ui.view" id="gnuhealth_prescription_invoice_view">
            <field name="model">gnuhealth.prescription.order</field>
            <field name="type">form</field>
            <field name="inherit" ref="health.gnuhealth_prescription_view"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/form/group[@id=&quot;prescription_patient_info&quot;]/field[@name=&quot;pharmacy&quot;]"
                        position="after">

                        <newline/>
                        <label name="no_invoice"/>
                        <field name="no_invoice"/>
                        <label name="invoice_status"/>
                        <field name="invoice_status" readonly="1"/>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>

    <!-- Prescription details -->

        <record model="ir.ui.view" id="gnuhealth_prescription_invoice_tree">
            <field name="model">gnuhealth.prescription.order</field>
            <field name="type">tree</field>
            <field name="inherit" ref="health.gnuhealth_prescription_tree"/>
            <field name="arch" type="xml">
                <![CDATA[
                <data>
                    <xpath
                        expr="/tree/field[@name=&quot;prescription_date&quot;]"
                        position="after">

                        <field name="no_invoice"/>
                        <field name="invoice_status"/>

                    </xpath>
                </data>
                ]]>
            </field>
        </record>


        <record model="ir.action.act_window" id="gnuhealth_action_invoiced_prescription">
            <field name="name">Invoiced Prescriptions</field>
            <field name="res_model">gnuhealth.prescription.order</field>
            <field name="domain">[('invoice_status','!=','tobe')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_prescription_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health.gnuhealth_prescription_tree"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_prescription"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_invoiced_prescription_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health.gnuhealth_prescription_view"/>
            <field name="act_window" ref="gnuhealth_action_invoiced_prescription"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_invoiced_prescription"
            id="gnuhealth_tobeinvoiced_prescription"/>

        <record model="ir.action.act_window" id="gnuhealth_action_tobeinvoiced_prescription">
            <field name="name">Prescriptions to be invoiced</field>
            <field name="res_model">gnuhealth.prescription.order</field>
            <field name="domain">[('invoice_status','=','tobe')]</field>
        </record>

        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_prescription_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="health.gnuhealth_prescription_tree"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_prescription"/>
        </record>
        <record model="ir.action.act_window.view" id="gnuhealth_action_tobeinvoiced_prescription_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="health.gnuhealth_prescription_view"/>
            <field name="act_window" ref="gnuhealth_action_tobeinvoiced_prescription"/>
        </record>

        <menuitem parent="gnuhealth_invoice_menu"
            action="gnuhealth_action_tobeinvoiced_prescription"
            id="gnuhealth_tobeinvoiced_prescription"/>

    </data>
</tryton>
